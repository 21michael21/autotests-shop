# Найденные баги

Документ содержит список багов, обнаруженных во время автоматизированного тестирования backend API интернет-магазина.

## Критические баги

### 1. Ошибка 500 вместо 400 при добавлении несуществующего товара

Описание: При попытке добавить несуществующий товар в корзину API возвращает Internal Server Error (500) вместо Bad Request (400).

Воспроизведение:
```bash
POST /cart/add
Authorization: Bearer <token>
{
  "item_id": 99999,
  "quantity": 1
}
```

Ожидаемый результат: HTTP 400 Bad Request с сообщением об ошибке
Фактический результат: HTTP 500 Internal Server Error

Файл теста: `tests/backend/cart/test_shopping_cart_operations.py::test_add_invalid_item`

Статус: Не исправлен

---

### 2. Отсутствие валидации существования товара

Описание: API не проверяет существование товара перед добавлением в корзину, что приводит к ошибке 500.

Проблема: Отсутствует проверка `item_id` в базе данных перед операцией добавления.

Влияние: Пользователи могут получить ошибку сервера вместо понятного сообщения об ошибке.

Статус: Не исправлен

---

## Средние баги

### 3. Невалидные параметры фильтрации не обрабатываются корректно

Описание: API принимает невалидные параметры фильтрации (отрицательные цены, неверные типы данных) без должной обработки.

Воспроизведение:
```bash
GET /catalog/?min_price=-100&max_price=invalid
Authorization: Bearer <token>
```

Ожидаемый результат: HTTP 400 Bad Request с описанием ошибки валидации
Фактический результат: HTTP 200 OK или 500 Internal Server Error

Файл теста: `tests/backend/catalog/test_product_catalog.py::test_invalid_filter_params`

Статус: Не исправлен

---

### 4. Отсутствие валидации на стороне сервера для username/password

Описание: Сервер не проверяет критерии валидации для username и password согласно требованиям.

Требования:
- Username: минимум 6 символов, только латиница и цифры
- Password: минимум 8 символов, заглавная, строчная, спецсимвол

Проблема: API принимает любые значения без валидации.

Статус: Не исправлен

---

## Мелкие баги

### 5. Неинформативные сообщения об ошибках

Описание: API возвращает общие сообщения об ошибках без детализации.

Примеры:
- "Invalid credentials" вместо "Username not found" или "Wrong password"
- "User already exists" без указания, какое именно поле конфликтует

Статус: Не исправлен

---

### 6. Отсутствие rate limiting

Описание: API не ограничивает количество запросов, что может привести к DoS атакам.

Проблема: Можно отправлять неограниченное количество запросов на регистрацию/логин.

Статус: Не исправлен

---

## Технические проблемы

### 7. Нестабильная работа с базой данных

Описание: Иногда возникают ошибки подключения к PostgreSQL.

Симптомы: 
- `psycopg2.OperationalError: could not connect to server`
- `psycopg2.InterfaceError: connection already closed`

Статус: Частично исправлено (добавлены retry механизмы в тестах)

---

### 8. Отсутствие логирования на стороне сервера

Описание: Сервер не логирует детали ошибок, что затрудняет отладку.

Проблема: При ошибке 500 нет информации о причине в логах сервера.

Статус: Не исправлено

---

## Статистика багов

| Тип бага | Количество | Статус |
|----------|------------|---------|
| Критические | 2 | 0 исправлено |
| Средние | 2 | 0 исправлено |
| Мелкие | 2 | 0 исправлено |
| Технические | 2 | 1 частично исправлено |
| Всего | 8 | 1 частично исправлено |

## Рекомендации по исправлению

Приоритет 1 (Критический)
1. Добавить валидацию существования товара перед добавлением в корзину
2. Исправить обработку ошибок (500 → 400 для валидационных ошибок)

Приоритет 2 (Средний)
3. Реализовать валидацию параметров фильтрации
4. Добавить серверную валидацию username/password

Приоритет 3 (Низкий)
5. Улучшить сообщения об ошибках
6. Добавить rate limiting
7. Улучшить логирование сервера

Примечания
- Все баги воспроизводятся стабильно
- Тесты автоматически обнаруживают эти проблемы
- Баги не блокируют основную функциональность, но ухудшают UX
- Рекомендуется исправить критические баги перед релизом
